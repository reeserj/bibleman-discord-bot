#!/bin/bash

# BibleMan Discord Bot - Global Command
# This script allows you to run the bot from anywhere with a simple command

set -e

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

# Configuration
BOT_DIR="/home/reese/.cursor/Bibleman"
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

print_status() {
    echo -e "${BLUE}[BibleMan]${NC} $1"
}

print_success() {
    echo -e "${GREEN}[BibleMan]${NC} $1"
}

print_warning() {
    echo -e "${YELLOW}[BibleMan]${NC} $1"
}

print_error() {
    echo -e "${RED}[BibleMan]${NC} $1"
}

# Function to show help
show_help() {
    echo "ðŸ¤– BibleMan Discord Bot - Global Command"
    echo "========================================"
    echo ""
    echo "Usage: bibleman [command]"
    echo ""
    echo "Commands:"
    echo "  start     - Start the bot (foreground)"
    echo "  service   - Start the bot as background service"
    echo "  stop      - Stop the background service"
    echo "  restart   - Restart the background service"
    echo "  status    - Check bot status"
    echo "  logs      - View bot logs"
    echo "  install   - Install as system command"
    echo "  uninstall - Remove system command"
    echo "  help      - Show this help"
    echo ""
    echo "Examples:"
    echo "  bibleman start     # Start bot in foreground"
    echo "  bibleman service  # Start as background service"
    echo "  bibleman status   # Check if running"
    echo "  bibleman logs     # View live logs"
}

# Function to start bot in foreground
start_bot() {
    print_status "Starting BibleMan bot in foreground..."
    cd "$BOT_DIR"
    ./start-bot.sh
}

# Function to manage service
manage_service() {
    cd "$BOT_DIR"
    ./run-bot-service.sh "$1"
}

# Function to install as system command
install_command() {
    print_status "Installing BibleMan as system command..."
    
    # Create symlink in /usr/local/bin
    if [ -w "/usr/local/bin" ]; then
        sudo ln -sf "$SCRIPT_DIR/bibleman" /usr/local/bin/bibleman
        print_success "BibleMan command installed successfully!"
        print_status "You can now run 'bibleman' from anywhere"
    else
        print_error "Cannot write to /usr/local/bin. Try running with sudo:"
        print_status "sudo $0 install"
        exit 1
    fi
}

# Function to uninstall system command
uninstall_command() {
    print_status "Uninstalling BibleMan system command..."
    
    if [ -L "/usr/local/bin/bibleman" ]; then
        sudo rm /usr/local/bin/bibleman
        print_success "BibleMan command uninstalled successfully!"
    else
        print_warning "BibleMan command not found in /usr/local/bin"
    fi
}

# Main execution
case "${1:-help}" in
    start)
        start_bot
        ;;
    service)
        manage_service "start"
        ;;
    stop)
        manage_service "stop"
        ;;
    restart)
        manage_service "restart"
        ;;
    status)
        manage_service "status"
        ;;
    logs)
        manage_service "logs"
        ;;
    install)
        install_command
        ;;
    uninstall)
        uninstall_command
        ;;
    help|--help|-h)
        show_help
        ;;
    *)
        print_error "Unknown command: $1"
        show_help
        exit 1
        ;;
esac

